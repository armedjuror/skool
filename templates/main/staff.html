{% extends 'main/layout.html' %}
{% load static %}

{% block page_title %}Staff Management{% endblock %}

{% block content %}
<!-- Filter Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-filter"></i> Filter Staff
                </h5>
            </div>
            <div class="card-body">
                <form id="staffFilterForm">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <label for="branchFilter" class="form-label">Branch</label>
                            <select class="form-select" id="branchFilter" name="branch">
                                <option value="">All Branches</option>
                            </select>
                        </div>

                        <div class="col-md-3 mb-3">
                            <label for="userTypeFilter" class="form-label">Role</label>
                            <select class="form-select" id="userTypeFilter" name="user_type">
                                <option value="">All Roles</option>
                                <option value="CHIEF_HEAD_TEACHER">Chief Head Teacher</option>
                                <option value="HEAD_TEACHER">Head Teacher</option>
                                <option value="TEACHER">Teacher</option>
                                <option value="ACCOUNTANT">Accountant</option>
                                <option value="OFFICE_STAFF">Office Staff</option>
                            </select>
                        </div>

                        <div class="col-md-3 mb-3">
                            <label for="categoryFilter" class="form-label">Category</label>
                            <select class="form-select" id="categoryFilter" name="category">
                                <option value="">All Categories</option>
                                <option value="PERMANENT">Permanent</option>
                                <option value="TEMPORARY">Temporary</option>
                            </select>
                        </div>

                        <div class="col-md-3 mb-3">
                            <label for="statusFilter" class="form-label">Status</label>
                            <select class="form-select" id="statusFilter" name="status">
                                <option value="">All Status</option>
                                <option value="ACTIVE">Active</option>
                                <option value="INACTIVE">Inactive</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="searchQuery" class="form-label">Search</label>
                            <input type="text" class="form-control" id="searchQuery" name="search"
                                   placeholder="Search by name, staff number, or email...">
                        </div>

                        <div class="col-md-6 mb-3 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary me-2">
                                <i class="fas fa-search"></i> Apply Filters
                            </button>
                            <button type="button" class="btn btn-outline-secondary" id="clearFilters">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Staff Table -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div id="staffTable">
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Loading staff...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Staff Modal -->
<div class="modal fade" id="staffModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staffModalTitle">Add Staff Member</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="staffForm">
                <div class="modal-body">
                    <input type="hidden" id="staffId" name="id">

                    <!-- Nav tabs -->
                    <ul class="nav nav-tabs mb-3" id="staffFormTabs">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#personalInfo">Personal Info</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#contactInfo">Contact & Address</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#employmentInfo">Employment</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#academicInfo">Academic Details</a>
                        </li>
                    </ul>

                    <!-- Tab content -->
                    <div class="tab-content">
                        <!-- Personal Info -->
                        <div class="tab-pane fade show active" id="personalInfo">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="fullName" class="form-label">Full Name *</label>
                                    <input type="text" class="form-control" id="fullName" name="full_name" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="email" class="form-label">Email *</label>
                                    <input type="email" class="form-control" id="email" name="email" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="gender" class="form-label">Gender *</label>
                                    <select class="form-select" id="gender" name="gender" required>
                                        <option value="">Select Gender</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="dob" class="form-label">Date of Birth *</label>
                                    <input type="date" class="form-control" id="dob" name="dob" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="userType" class="form-label">Role *</label>
                                    <select class="form-select" id="userType" name="user_type" required>
                                        <option value="">Select Role</option>
                                        <option value="CHIEF_HEAD_TEACHER">Chief Head Teacher</option>
                                        <option value="HEAD_TEACHER">Head Teacher</option>
                                        <option value="TEACHER">Teacher</option>
                                        <option value="ACCOUNTANT">Accountant</option>
                                        <option value="OFFICE_STAFF">Office Staff</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="idCardType" class="form-label">ID Type *</label>
                                    <select class="form-select" id="idCardType" name="id_card_type" required>
                                        <option value="QID">Qatar ID</option>
                                        <option value="PASSPORT">Passport</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="idCardNumber" class="form-label">ID Number *</label>
                                    <input type="text" class="form-control" id="idCardNumber" name="id_card_number" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="photo" class="form-label">Photo</label>
                                    <input type="file" class="form-control" id="photo" name="photo" accept="image/*">
                                </div>
                            </div>
                        </div>

                        <!-- Contact Info -->
                        <div class="tab-pane fade" id="contactInfo">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="mobile" class="form-label">Mobile Number *</label>
                                    <input type="tel" class="form-control" id="mobile" name="mobile" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="whatsapp" class="form-label">WhatsApp Number</label>
                                    <input type="tel" class="form-control" id="whatsapp" name="whatsapp">
                                </div>
                            </div>
                            <h6 class="mt-3 mb-2">Qatar Address</h6>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="qatarPlace" class="form-label">Place</label>
                                    <input type="text" class="form-control" id="qatarPlace" name="qatar_place">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="qatarBuildingNo" class="form-label">Building No</label>
                                    <input type="text" class="form-control" id="qatarBuildingNo" name="qatar_building_no">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="qatarStreetNo" class="form-label">Street No</label>
                                    <input type="text" class="form-control" id="qatarStreetNo" name="qatar_street_no">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="qatarZoneNo" class="form-label">Zone No</label>
                                    <input type="text" class="form-control" id="qatarZoneNo" name="qatar_zone_no">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="qatarLandmark" class="form-label">Landmark</label>
                                    <input type="text" class="form-control" id="qatarLandmark" name="qatar_landmark">
                                </div>
                            </div>
                            <h6 class="mt-3 mb-2">India Address</h6>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="indiaState" class="form-label">State</label>
                                    <input type="text" class="form-control" id="indiaState" name="india_state">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="indiaDistrict" class="form-label">District</label>
                                    <input type="text" class="form-control" id="indiaDistrict" name="india_district">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="indiaPanchayath" class="form-label">Panchayath</label>
                                    <input type="text" class="form-control" id="indiaPanchayath" name="india_panchayath">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="indiaPlace" class="form-label">Place</label>
                                    <input type="text" class="form-control" id="indiaPlace" name="india_place">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="indiaHouseName" class="form-label">House Name</label>
                                    <input type="text" class="form-control" id="indiaHouseName" name="india_house_name">
                                </div>
                            </div>
                        </div>

                        <!-- Employment Info -->
                        <div class="tab-pane fade" id="employmentInfo">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="branch" class="form-label">Branch *</label>
                                    <select class="form-select" id="branch" name="branch" required>
                                        <option value="">Select Branch</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="category" class="form-label">Category *</label>
                                    <select class="form-select" id="category" name="category" required>
                                        <option value="PERMANENT">Permanent</option>
                                        <option value="TEMPORARY">Temporary</option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="staffStatus" class="form-label">Status *</label>
                                    <select class="form-select" id="staffStatus" name="status" required>
                                        <option value="ACTIVE">Active</option>
                                        <option value="INACTIVE">Inactive</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="monthlySalary" class="form-label">Monthly Salary *</label>
                                    <input type="number" step="0.01" class="form-control" id="monthlySalary" name="monthly_salary" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="aadharNumber" class="form-label">Aadhar Number</label>
                                    <input type="text" class="form-control" id="aadharNumber" name="aadhar_number" maxlength="12">
                                </div>
                            </div>
                            <h6 class="mt-3 mb-2">Allowances</h6>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="transportAllowance" class="form-label">Transport Allowance</label>
                                    <input type="number" step="0.01" class="form-control" id="transportAllowance" name="transport_allowance" value="0">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="foodAllowance" class="form-label">Food Allowance</label>
                                    <input type="number" step="0.01" class="form-control" id="foodAllowance" name="food_allowance" value="0">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="mobileAllowance" class="form-label">Mobile Allowance</label>
                                    <input type="number" step="0.01" class="form-control" id="mobileAllowance" name="mobile_allowance" value="0">
                                </div>
                            </div>
                        </div>

                        <!-- Academic Info -->
                        <div class="tab-pane fade" id="academicInfo">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="religiousAcademicDetails" class="form-label">Religious Academic Details</label>
                                    <textarea class="form-control" id="religiousAcademicDetails" name="religious_academic_details" rows="3"></textarea>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="academicDetails" class="form-label">Academic Details</label>
                                    <textarea class="form-control" id="academicDetails" name="academic_details" rows="3"></textarea>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="previousMadrasa" class="form-label">Previous Madrasa</label>
                                    <input type="text" class="form-control" id="previousMadrasa" name="previous_madrasa">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="msrNumber" class="form-label">MSR Number</label>
                                    <input type="text" class="form-control" id="msrNumber" name="msr_number">
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <label for="notes" class="form-label">Notes</label>
                                    <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="staffFormSubmit">
                        <i class="fas fa-save"></i> Save Staff
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Staff Detail Modal -->
<div class="modal fade" id="staffDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Staff Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="staffDetailBody">
                <!-- Content loaded dynamically -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="editStaffBtn">
                    <i class="fas fa-edit"></i> Edit
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/staff.js' %}"></script>
{% endblock %}
